Brazilian global Atmospheric Model - BAM
========================================

* Versão: V1.2.1 (operacional em 2019)
* Wiki desta versão: https://projetos.cptec.inpe.br/projects/bam/wiki/BAM_V121

Notas da Versão:
================

Esta versão do BAM pode possuir algumas limitações em relação ao uso dos seguintes compiladores (testes realizados na Tupã):

       PRE | MODEL | POS
------------------------
PGI  | OK  | OK    | OK
GNU  | OK  | OK    | OK 
CRAY | X   | OK    | OK 

Veja mais detalhes sobre estas limitações na página "Problemas Conhecidos", disponível em https://projetos.cptec.inpe.br/projects/bam/wiki/Problemas_Conhecidos.

Copyright Under GLP-3.0 (https://opensource.org/licenses/GPL-3.0)

Contato:
========

Para sanar dúvidas ou obter mais informações sobre o modelo BAM, envie um email para atende.cptec@inpe.br.

Instruções de uso:
==================

1) Baixar o pacote:

$ svn export https://svn.cptec.inpe.br/bam/branch/BAM_V1.2.1

2) Editar o arquivo "BAM_V1.2.1/etc/paths.conf":

$ cd BAM_V1.2.1
$ cd etc/
$ vim paths.conf

- Rever e alterar o valor das seguintes variáveis:

* NameInstall (eg., NameInstall BAM_V1.2.1)
* HOME        (eg., HOME        ${SUBMIT_HOME}) 
* SUBMIT_HOME (eg., SUBMIT_HOME ${SUBMIT_HOME})
* WORK_HOME   (eg., WORK_HOME   ${WORK_HOME})

- Rever e alterar o valor das seguintes variáveis:

* home_bam (eg., home_bam ${SUBMIT_HOME}/${NameInstall})
* subt_bam (eg., subt_bam ${SUBMIT_HOME}/${NameInstall})
* work_bam (eg., work_bam ${WORK_HOME}/${NameInstall})

3) Executar o script "BAM_V1.2.1/config_bam.sh" com a opção "configurar":

$ cd BAM_V1.2.1
$ ./config_bam.sh configurar

- Rever as informações na tela e pressionar "S" para prosseguir ou "N" para abortar.

4) Logar na eslogin01 ou na eslogin02 e compilar:

$ ssh eslogin01 -XC
$ cd BAM_V1.2.1
$ ./config_bam.sh compilar

- O script "config_bam.sh" junto com a opção compilar, automatiza o processo de compilação do pre/model/pos. O compilador padrão (default) utilizado na Tupã, é o PGI. Para utilizar esta opção, certifique-se de que esta versão do BAM é compatível com o compilador PGI.

- Se for necessário compilar individualmente pre/model/pos, proceda da seguinte forma:

* Com o compilador PGI (default):

$ ssh eslogin01 -XC
$ cd BAM_V1.2.1/pre/sources
$ make pgi_cray
$ cd BAM_V1.2.1/model/source
$ make pgi_cray
$ cd BAM_V1.2.1/pos/source
$ make pgi_cray

* Com o compilador CRAY:

$ ssh eslogin01 -XC
$ module swap PrgEnv-pgi/4.0.46 PrgEnv-cray
$ cd BAM_V1.2.1/pre/sources
$ make cray_cray32
$ cd BAM_V1.2.1/model/source
$ make cray_cray32
$ cd BAM_V1.2.1/pos/source
$ make cray_cray32

* Com o compilador GNU:

$ ssh eslogin01 -XC
$ module swap PrgEnv-pgi/4.0.46 PrgEnv-gnu
$ cd BAM_V1.2.1/pre/sources
$ make gnu_cray
$ cd BAM_V1.2.1/model/source
$ make gnu_cray
$ cd BAM_V1.2.1/pos/source
$ make gnu_cray

Após a compilação, verifique a presença dos seguintes executáveis:

- pre/exec:
Albedo                    NDVIClima               SNOWWeeklyNCEP            TopographyGradient
AlbedoClima               NormalModes             SoilMoisture              TopoSpectral
Chopping_parallel         PorceClayMaskIBIS       SoilMoistureClima         TopoWaterPercGT30
Chopping_serial           PorceClayMaskIBISClima  SoilMoistureWeekly        TopoWaterPercNavy
CLimaSoilMoisture         PorceClayMaskSiB2       SoilMoistureWeeklyCPTEC   VarTopo
CLimaSoilMoistureClima    PorceClayMaskSiB2Clima  SoilTextureMaskSiB2       VegetationAlbedoSSiB
CO2MonthlyDirec           PorceSandMaskIBIS       SoilTextureMaskSiB2Clima  VegetationMask
DeepSoilTemperature       PorceSandMaskIBISClima  SSTClima                  VegetationMaskIBIS
DeepSoilTemperatureClima  PorceSandMaskSiB2       SSTDailyDirec             VegetationMaskIBISClima
DeltaTempColdest          PorceSandMaskSiB2Clima  SSTMonthlyDirec           VegetationMaskSiB2
DeltaTempColdestClima     RoughnessLength         SSTWeekly                 VegetationMaskSiB2Clima
FLUXCO2Clima              RoughnessLengthClima    SSTWeeklyNCEP             VegetationMaskSSiB
LandSeaMask               SnowClima               Temperature
NDVI                      SNOWWeekly              TemperatureClima

- mode/exec:
ParModel_MPI

- pos/exec:
PostGrib

5) Uso:

- Execute o script "BAM_V1.2.1/config_bam.sh" com a opção "testcase" e escolha a opção "2013".

- No exemplo a seguir, considera-se como condição inicial a análise atmosférica espectral do NCEP, válida para o dia 2012123118, na resolução TQ0574L064. O modelo será realizado para previsões entre 2013010100 até 2013010118 (com saídas a cada 6 horas), na resolução TQ0126L028.

- Pré-processamento (preparação das condições iniciais e de contorno):

$ cd BAM_V1.2.1/run
$ ./runPre 126 28 2012123118 NMC 1 T F 574 64 

- Verificar as saídas do pré-processamento em:

* BAM_V1.2.1/pre/dataout
* BAM_V1.2.1/model/datain

- Modelo (realização das previsões):

$ cd BAM_V1.2.1/run
$ ./runModel -t 126 -l 28 -np 48 -d 4 -N 6 -I 2012123118 -W 2013010118 -F 2013010118 -ts 6 -p SMT -s sstwkl

- Verificar as saídas (previsões espectrais) do modelo em:

* BAM_V1.2.1/model/dataout

- Pós-processamento (preparação das previsões para visualização em ponto de grade):

Obs.: Verifique o namelist do pós-processamento (arquivo run/POSTIN-GRIB) e reveja os níveis de pressão para os quais as previsão deverão ser interpoladas. Para isto, verifique o valor da veriável "nmand" (na seção PosInput do namelist) e os valores do array "plevs" (na seção PressureLevel do namelist).

$ cd BAM_V1.2.1/run
$ ./runPos -t 126 -l 28 -I 2012123118 -F 2013010118 -p CPT

- Verificar as saídas (previsões em ponto de grade) do pós-processamento em:

* BAM_V1.2.1/pos/dataout
